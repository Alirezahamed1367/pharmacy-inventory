# Runbook سریع بهره‌برداری (Fast Track)

هدف: اجرای سریع سیستم بدون درگیر شدن با Auth پیچیده و RLS دقیق (RLS موقتاً غیرفعال است).

## 1. پیش‌نیازها
- Node.js 18+
- حساب Supabase
- باکت `drug-images` (Public)

## 2. تنظیم محیط
```bash
cp .env.example .env
# مقداردهی: VITE_SUPABASE_URL و VITE_SUPABASE_ANON_KEY
npm install
```

## 3. پایگاه داده
در Supabase SQL Editor به ترتیب اجرا کنید (اگر قبلاً اجرا نشده):
1. 2025_10_03_add_manager_and_lots.sql
2. 2025_10_03_adjust_drugs_policies.sql (می‌تواند بعداً نادیده گرفته شود)
3. 2025_10_04_relax_drugs_rls_and_fk.sql (تنظیم FK و باز کردن درج دارو)
4. 2025_10_04_fasttrack_relax_rls.sql (غیرفعال کردن کامل RLS برای تست سریع)
-- (اختیاری در آینده: 2025_10_03_enforce_lot_not_null.sql پس از audit)

## 4. اجرای محلی
```bash
npm run dev
```

## 5. سناریوی تست سریع
1. افزودن 2 دارو با تاریخ آینده (فرمت DD/MM/YYYY)
2. ایجاد یک Receipt با چند آیتم (فقط انتخاب دارو و تعداد)
3. تکمیل Receipt → بررسی افزایش موجودی
4. ایجاد یک Transfer بین دو انبار و تکمیل → بررسی موجودی مقصد
5. آپلود تصویر دارو
6. اجرای `npm run smoke`
 7. (اختیاری) اجرای Seed خودکار:
	```bash
	npm run seed:demo
	```
	سپس فقط تست Transfer / Receipt را انجام دهید.

## 6. دیپلوی
- Vercel: اتصال مخزن و Build command: `npm run build`
- متغیرهای محیطی را در Vercel مانند فایل .env تنظیم کنید.

## 7. پس از دیپلوی
- تست همان سناریوها روی Production
- اجرای اسکریپت عملکرد تصویر (اختیاری):
```bash
npm run perf:images
```

## 8. قدم‌های بعدی (وقتی آماده شدید)
- یکپارچه‌سازی Supabase Auth
- فعال‌سازی دوباره RLS و اعمال سیاست اصول حداقل دسترسی
- اجرای `npm run audit:lots` و سپس مهاجرت NOT NULL lots
- تفکیک فایل supabase.js به سرویس‌های کوچکتر

## 9. چینش اولویت‌ها بعد از بهره‌برداری
| گام | ارزش | سختی | توضیح |
|-----|------|------|-------|
| Auth + RLS امن | بالا | متوسط | فعال‌سازی کنترل دسترسی واقعی |
| NOT NULL lots | متوسط | پایین | جلوگیری از داده ناقص |
| Refactor services | متوسط | متوسط | نگهداری بهتر |
| مانیتورینگ خطا | متوسط | کم | افزودن Sentry یا Logflare |

## 10. یادآوری امنیتی
در حالت فعلی همه جداول بدون RLS هستند؛ داده حساس نگهداری نکنید تا وقتی RLS و Auth کامل شوند.

---
طراحی و توسعه: علیرضا حامد - پاییز 1404
